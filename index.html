<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduFlow - Automated Attendance System (Frontend Only)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
        }

        .login-container {
            padding: 60px;
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .dashboard-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .attendance-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 12px;
            color: #666;
            margin-bottom: 0;
        }

        .filter-group select, .filter-group input {
            padding: 8px 12px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .status-present {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-absent {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            border: 1px solid transparent;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .class-group {
            display: none;
        }

        .demo-note {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #bbdefb;
            text-align: center;
        }

        .data-controls {
            margin: 20px 0;
            text-align: center;
        }

        .data-controls button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        @media (max-width: 768px) {
            .login-container {
                padding: 40px 20px;
            }
            
            .dashboard-container {
                padding: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <div class="demo-note">
                <h4><i class="fas fa-info-circle"></i> Frontend-Only Demo</h4>
                <p>This is a demonstration version that works with mock data stored locally. No backend server required!</p>
            </div>
            
            <div class="logo">E</div>
            <h1>EduFlow</h1>
            <p class="subtitle">Automated Attendance System</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="role">Select Role:</label>
                    <select id="role" required>
                        <option value="">Choose your role</option>
                        <option value="government">Government Official</option>
                        <option value="teacher">Teacher</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" required placeholder="Enter username">
                </div>
                
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" required placeholder="Enter password">
                </div>
                
                <div id="classGroup" class="form-group class-group">
                    <label for="teacherClass">Select Your Class:</label>
                    <select id="teacherClass">
                        <option value="">Choose your class</option>
                        <option value="CSE-IOT">CSE-IOT</option>
                        <option value="CSE-AIML">CSE-AIML</option>
                        <option value="CSE-CORE">CSE-CORE</option>
                        <option value="ECE-A">ECE-A</option>
                        <option value="ECE-B">ECE-B</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Login</button>
            </form>
            
            <div class="demo-note">
                <strong>Demo Credentials:</strong><br>
                Government: admin / admin123<br>
                Teacher: teacher / teacher123
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="dashboard-container">
            <div class="dashboard-header">
                <div>
                    <h2 id="dashboardTitle">EduFlow Dashboard</h2>
                    <span id="userInfo" class="user-info">Welcome!</span>
                </div>
                <div>
                    <button class="btn-primary" onclick="generateSampleData()" style="margin-right: 10px;">
                        <i class="fas fa-plus"></i> Add Sample Data
                    </button>
                    <button class="btn-warning" onclick="clearAllData()" style="margin-right: 10px;">
                        <i class="fas fa-trash"></i> Clear Data
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="attendance-table" style="margin-bottom: 20px;">
                <div class="table-header">
                    <h3>Filters & Options</h3>
                    <div class="filters">
                        <div class="filter-group" id="classFilter" style="display: none;">
                            <label>Class:</label>
                            <select id="classSelect" onchange="updateAnalytics()">
                                <option value="all">All Classes</option>
                                <option value="CSE-IOT">CSE-IOT</option>
                                <option value="CSE-AIML">CSE-AIML</option>
                                <option value="CSE-CORE">CSE-CORE</option>
                                <option value="ECE-A">ECE-A</option>
                                <option value="ECE-B">ECE-B</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Start Date:</label>
                            <input type="date" id="startDate" onchange="updateAnalytics()">
                        </div>
                        <div class="filter-group">
                            <label>End Date:</label>
                            <input type="date" id="endDate" onchange="updateAnalytics()">
                        </div>
                        <div class="filter-group">
                            <label>Time Period:</label>
                            <select id="timePeriod" onchange="updateAnalytics()">
                                <option value="">Custom Range</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>&nbsp;</label>
                            <button class="btn-success" onclick="updateAnalytics()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalStudents">0</span>
                    <span class="stat-label">Total Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="presentToday">0</span>
                    <span class="stat-label">Present Today</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="absentToday">0</span>
                    <span class="stat-label">Absent Today</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="attendanceRate">0%</span>
                    <span class="stat-label">Attendance Rate</span>
                </div>
            </div>

            <!-- Analytics Charts -->
            <div class="chart-grid">
                <div class="chart-container">
                    <h3>Today's Attendance</h3>
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; color: #28a745; font-weight: bold;" id="todayPresent">0</div>
                        <div style="font-size: 24px; color: #666; margin: 10px 0;">Students Present</div>
                        <div style="font-size: 18px; color: #999;" id="todayStats">Out of 0 total students</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>This Week's Average</h3>
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; color: #17a2b8; font-weight: bold;" id="weeklyPresent">0</div>
                        <div style="font-size: 24px; color: #666; margin: 10px 0;">Average Present</div>
                        <div style="font-size: 18px; color: #999;" id="weeklyStats">Daily average this week</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>This Month's Average</h3>
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; color: #6f42c1; font-weight: bold;" id="monthlyPresent">0</div>
                        <div style="font-size: 24px; color: #666; margin: 10px 0;">Average Present</div>
                        <div style="font-size: 18px; color: #999;" id="monthlyStats">Daily average this month</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Overall Statistics</h3>
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; color: #20c997; font-weight: bold;" id="overallPresent">0</div>
                        <div style="font-size: 24px; color: #666; margin: 10px 0;">Overall Average</div>
                        <div style="font-size: 18px; color: #999;" id="overallStats">All time attendance rate</div>
                    </div>
                </div>
            </div>

            <!-- Attendance Table -->
            <div class="attendance-table">
                <div class="table-header">
                    <h3>Recent Attendance Records</h3>
                </div>
                <div style="overflow-x: auto;">
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Roll No</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <tr>
                                <td colspan="6" class="loading">No attendance data. Click "Add Sample Data" to generate demo records.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let attendanceData = [];
        let currentUser = null;
        let currentUserClass = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            setDefaultDates();
            loadStoredData();
        });

        function setupEventListeners() {
            // Role selection handler
            document.getElementById('role').addEventListener('change', function() {
                const classGroup = document.getElementById('classGroup');
                if (this.value === 'teacher') {
                    classGroup.style.display = 'block';
                    document.getElementById('teacherClass').required = true;
                } else {
                    classGroup.style.display = 'none';
                    document.getElementById('teacherClass').required = false;
                }
            });

            // Login form handler
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        }

        function setDefaultDates() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        }

        function loadStoredData() {
            const storedData = localStorage.getItem('eduflow_attendance');
            if (storedData) {
                attendanceData = JSON.parse(storedData);
                console.log(`Loaded ${attendanceData.length} records from localStorage`);
            }
        }

        function saveDataToStorage() {
            localStorage.setItem('eduflow_attendance', JSON.stringify(attendanceData));
            console.log(`Saved ${attendanceData.length} records to localStorage`);
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const role = document.getElementById('role').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const teacherClass = document.getElementById('teacherClass').value;

            // Validate teacher class selection
            if (role === 'teacher' && !teacherClass) {
                alert('Please select your class');
                return;
            }

            // Demo credentials validation
            const validCredentials = {
                'government': { 'admin': 'admin123' },
                'teacher': { 'teacher': 'teacher123' }
            };

            if (validCredentials[role] && validCredentials[role][username] === password) {
                currentUser = {
                    username: username,
                    role: role
                };
                
                if (role === 'teacher') {
                    currentUserClass = teacherClass;
                }

                showDashboard();
            } else {
                alert('Invalid credentials! Use: admin/admin123 for Government or teacher/teacher123 for Teacher');
            }
        }

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';

            // Update dashboard title and user info
            const title = currentUser.role === 'government' ? 'EduFlow - Government Dashboard' : 'EduFlow - Teacher Dashboard';
            document.getElementById('dashboardTitle').textContent = title;
            
            let userInfo = `Welcome, ${currentUser.username} (${currentUser.role})`;
            if (currentUserClass) {
                userInfo += ` - ${currentUserClass}`;
            }
            document.getElementById('userInfo').textContent = userInfo;

            // Show/hide class filter based on role
            if (currentUser.role === 'government') {
                document.getElementById('classFilter').style.display = 'block';
            }

            // Load dashboard data
            updateAnalytics();
        }

        function generateSampleData() {
            const classes = ['CSE-IOT', 'CSE-AIML', 'CSE-CORE', 'ECE-A', 'ECE-B'];
            const names = [
                'Rajat Sharma', 'Priya Singh', 'Amit Kumar', 'Sneha Patel', 'Rahul Gupta',
                'Kavya Reddy', 'Arjun Nair', 'Pooja Agarwal', 'Vikram Singh', 'Ananya Das',
                'Ravi Kumar', 'Meera Joshi', 'Karan Malik', 'Divya Sharma', 'Nikhil Rao',
                'Shreya Bansal', 'Aditya Verma', 'Tanya Khanna', 'Harsh Goel', 'Nidhi Jain'
            ];

            // Generate data for the past 30 days
            const today = new Date();
            const newRecords = [];

            for (let i = 0; i < 30; i++) {
                const date = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
                const dateStr = date.toISOString().split('T')[0];
                
                // Generate attendance for random number of students each day
                const studentsPresent = Math.floor(Math.random() * 15) + 5; // 5-20 students per day
                
                for (let j = 0; j < studentsPresent; j++) {
                    const studentIndex = Math.floor(Math.random() * names.length);
                    const classIndex = Math.floor(Math.random() * classes.length);
                    const rollNo = `${classes[classIndex]}-${String(studentIndex + 1).padStart(3, '0')}`;
                    
                    // Generate random time between 8:00 AM and 10:00 AM
                    const hour = Math.floor(Math.random() * 2) + 8; // 8 or 9
                    const minute = Math.floor(Math.random() * 60);
                    const timeStr = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
                    
                    // Avoid duplicates for same student on same day
                    const existingRecord = newRecords.find(r => 
                        r.DATE === dateStr && r['ROLL NO'] === rollNo
                    );
                    
                    if (!existingRecord) {
                        newRecords.push({
                            NAME: names[studentIndex],
                            CLASS: classes[classIndex],
                            'ROLL NO': rollNo,
                            DATE: dateStr,
                            TIME: timeStr
                        });
                    }
                }
            }

            // Add new records to existing data
            attendanceData = [...attendanceData, ...newRecords];
            saveDataToStorage();
            
            showMessage(`Generated ${newRecords.length} sample attendance records!`, 'success');
            updateAnalytics();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all attendance data? This cannot be undone.')) {
                attendanceData = [];
                saveDataToStorage();
                showMessage('All attendance data has been cleared.', 'warning');
                updateAnalytics();
            }
        }

        function updateAnalytics() {
            updateStatistics();
            updateAttendanceTable();
            updateAnalyticsCharts();
        }

        function updateStatistics() {
            let data = attendanceData || [];
            
            // Filter by class for teachers
            if (currentUser.role === 'teacher' && currentUserClass) {
                data = data.filter(record => record.CLASS === currentUserClass);
            }

            // Filter by selected class for government
            const selectedClass = document.getElementById('classSelect')?.value;
            if (currentUser.role === 'government' && selectedClass && selectedClass !== 'all') {
                data = data.filter(record => record.CLASS === selectedClass);
            }

            // Filter by date range
            const startDate = document.getElementById('startDate')?.value;
            const endDate = document.getElementById('endDate')?.value;
            
            if (startDate && endDate) {
                data = data.filter(record => {
                    const recordDate = new Date(record.DATE);
                    return recordDate >= new Date(startDate) && recordDate <= new Date(endDate);
                });
            }

            // Filter by time period
            const timePeriod = document.getElementById('timePeriod')?.value;
            if (timePeriod) {
                const now = new Date();
                let filterStartDate;
                
                switch(timePeriod) {
                    case 'today':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        filterStartDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'year':
                        filterStartDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }
                
                if (filterStartDate && (!startDate || !endDate)) {
                    data = data.filter(record => {
                        const recordDate = new Date(record.DATE);
                        return recordDate >= filterStartDate && recordDate <= now;
                    });
                }
            }

            // Get today's date
            const today = new Date().toISOString().split('T')[0];
            
            // Calculate statistics
            const totalStudents = new Set(data.map(record => record['ROLL NO'])).size;
            const todayRecords = data.filter(record => record.DATE === today);
            const uniquePresentToday = new Set(
                todayRecords.filter(record => record.TIME && record.TIME.trim() !== '').map(record => record['ROLL NO'])
            ).size;
            const absentToday = Math.max(0, totalStudents - uniquePresentToday);
            const attendanceRate = totalStudents > 0 ? Math.round((uniquePresentToday / totalStudents) * 100) : 0;

            // Update UI
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('presentToday').textContent = uniquePresentToday;
            document.getElementById('absentToday').textContent = absentToday;
            document.getElementById('attendanceRate').textContent = attendanceRate + '%';
        }

        function updateAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            
            let filteredData = attendanceData;
            
            // Apply same filters as in updateStatistics
            if (currentUser.role === 'teacher' && currentUserClass) {
                filteredData = filteredData.filter(record => record.CLASS === currentUserClass);
            }

            const selectedClass = document.getElementById('classSelect').value;
            if (currentUser.role === 'government' && selectedClass !== 'all') {
                filteredData = filteredData.filter(record => record.CLASS === selectedClass);
            }

            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (startDate && endDate) {
                filteredData = filteredData.filter(record => {
                    const recordDate = new Date(record.DATE);
                    return recordDate >= new Date(startDate) && recordDate <= new Date(endDate);
                });
            }

            const timePeriod = document.getElementById('timePeriod').value;
            if (timePeriod) {
                const now = new Date();
                let filterStartDate;
                
                switch(timePeriod) {
                    case 'today':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        filterStartDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'year':
                        filterStartDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }
                
                if (filterStartDate && (!startDate || !endDate)) {
                    filteredData = filteredData.filter(record => {
                        const recordDate = new Date(record.DATE);
                        return recordDate >= filterStartDate && recordDate <= now;
                    });
                }
            }

            tbody.innerHTML = '';

            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="loading">No attendance records found for selected filters</td></tr>';
                return;
            }

            // Sort by date and time (most recent first)
            filteredData.sort((a, b) => {
                const dateA = new Date(a.DATE + ' ' + (a.TIME || '00:00'));
                const dateB = new Date(b.DATE + ' ' + (b.TIME || '00:00'));
                return dateB - dateA;
            });

            // Show latest 50 records
            filteredData.slice(0, 50).forEach(record => {
                const row = document.createElement('tr');
                const status = record.TIME ? 'present' : 'absent';
                
                row.innerHTML = `
                    <td>${record.NAME}</td>
                    <td>${record.CLASS}</td>
                    <td>${record['ROLL NO']}</td>
                    <td>${formatDate(record.DATE)}</td>
                    <td>${record.TIME || '-'}</td>
                    <td><span class="status-${status}">${status.toUpperCase()}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateAnalyticsCharts() {
            let data = attendanceData || [];
            
            // Apply same filters
            if (currentUser.role === 'teacher' && currentUserClass) {
                data = data.filter(record => record.CLASS === currentUserClass);
            }

            const selectedClass = document.getElementById('classSelect')?.value;
            if (currentUser.role === 'government' && selectedClass && selectedClass !== 'all') {
                data = data.filter(record => record.CLASS === selectedClass);
            }

            const startDate = document.getElementById('startDate')?.value;
            const endDate = document.getElementById('endDate')?.value;
            
            if (startDate && endDate) {
                data = data.filter(record => {
                    const recordDate = new Date(record.DATE);
                    return recordDate >= new Date(startDate) && recordDate <= new Date(endDate);
                });
            }

            const timePeriod = document.getElementById('timePeriod')?.value;
            if (timePeriod) {
                const now = new Date();
                let filterStartDate;
                
                switch(timePeriod) {
                    case 'today':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        filterStartDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        filterStartDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'year':
                        filterStartDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }
                
                if (filterStartDate && (!startDate || !endDate)) {
                    data = data.filter(record => {
                        const recordDate = new Date(record.DATE);
                        return recordDate >= filterStartDate && recordDate <= now;
                    });
                }
            }

            updateDailyChart(data);
            updateWeeklyChart(data);
            updateMonthlyChart(data);
            updateOverallChart(data);
        }

        function updateDailyChart(data) {
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = data.filter(record => record.DATE === today);
            const uniqueStudentsPresent = new Set(
                todayRecords.filter(record => record.TIME).map(record => record['ROLL NO'])
            ).size;
            
            const totalUniqueStudents = new Set(data.map(record => record['ROLL NO'])).size;
            const totalStudents = totalUniqueStudents > 0 ? totalUniqueStudents : 0;
            const absent = Math.max(0, totalStudents - uniqueStudentsPresent);

            document.getElementById('todayPresent').textContent = uniqueStudentsPresent;
            document.getElementById('todayStats').textContent = `${absent} absent out of ${totalStudents} total students`;
        }

        function updateWeeklyChart(data) {
            const totalUniqueStudents = new Set(data.map(record => record['ROLL NO'])).size;
            const totalStudents = totalUniqueStudents > 0 ? totalUniqueStudents : 0;
            let totalPresent = 0;
            let daysCount = 0;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayRecords = data.filter(record => record.DATE === dateStr);
                if (dayRecords.length > 0) {
                    const presentCount = new Set(
                        dayRecords.filter(record => record.TIME).map(record => record['ROLL NO'])
                    ).size;
                    totalPresent += presentCount;
                    daysCount++;
                }
            }
            
            const avgPresent = daysCount > 0 ? Math.round(totalPresent / daysCount) : 0;

            document.getElementById('weeklyPresent').textContent = avgPresent;
            document.getElementById('weeklyStats').textContent = totalStudents > 0 ? 
                `${Math.round((avgPresent/totalStudents)*100)}% attendance rate` : 'No data available';
        }

        function updateMonthlyChart(data) {
            const totalUniqueStudents = new Set(data.map(record => record['ROLL NO'])).size;
            const totalStudents = totalUniqueStudents > 0 ? totalUniqueStudents : 0;
            let totalPresent = 0;
            let daysCount = 0;
            
            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayRecords = data.filter(record => record.DATE === dateStr);
                if (dayRecords.length > 0) {
                    const presentCount = new Set(
                        dayRecords.filter(record => record.TIME).map(record => record['ROLL NO'])
                    ).size;
                    totalPresent += presentCount;
                    daysCount++;
                }
            }
            
            const avgPresent = daysCount > 0 ? Math.round(totalPresent / daysCount) : 0;

            document.getElementById('monthlyPresent').textContent = avgPresent;
            document.getElementById('monthlyStats').textContent = totalStudents > 0 ? 
                `${Math.round((avgPresent/totalStudents)*100)}% attendance rate` : 'No data available';
        }

        function updateOverallChart(data) {
            const totalUniqueStudents = new Set(data.map(record => record['ROLL NO'])).size;
            const totalStudents = totalUniqueStudents > 0 ? totalUniqueStudents : 0;
            
            const uniqueDates = [...new Set(data.map(record => record.DATE))];
            let totalPresentAcrossDays = 0;
            let validDaysCount = 0;
            
            uniqueDates.forEach(date => {
                const dayRecords = data.filter(record => record.DATE === date);
                if (dayRecords.length > 0) {
                    const presentCount = new Set(
                        dayRecords.filter(record => record.TIME).map(record => record['ROLL NO'])
                    ).size;
                    totalPresentAcrossDays += presentCount;
                    validDaysCount++;
                }
            });
            
            const avgPresent = validDaysCount > 0 ? Math.round(totalPresentAcrossDays / validDaysCount) : 0;

            document.getElementById('overallPresent').textContent = avgPresent;
            document.getElementById('overallStats').textContent = totalStudents > 0 ? 
                `${Math.round((avgPresent/totalStudents)*100)}% average attendance` : 'No data available';
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('attendanceTableBody').parentElement;
            const messageDiv = document.createElement('div');
            const alertClass = type === 'error' ? 'danger' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : 'info';
            messageDiv.className = `alert alert-${alertClass}`;
            messageDiv.style.margin = '20px 0';
            messageDiv.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            
            // Remove existing messages
            const existingMessages = container.querySelectorAll('.alert');
            existingMessages.forEach(msg => msg.remove());
            
            // Add new message
            container.insertBefore(messageDiv, container.firstChild);
            
            // Auto-remove success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    if (messageDiv && messageDiv.parentElement) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        function logout() {
            currentUser = null;
            currentUserClass = null;
            
            // Reset form
            document.getElementById('loginForm').reset();
            document.getElementById('classGroup').style.display = 'none';
            
            // Show login section
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            
            console.log('Logged out successfully');
        }

        // Auto-generate some initial sample data if none exists
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (attendanceData.length === 0) {
                    console.log('No data found, generating initial sample data...');
                    // Don't automatically generate data - let user choose
                }
            }, 1000);
        });
    </script>
</body>
</html>
